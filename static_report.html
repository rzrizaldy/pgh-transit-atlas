<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGH Transit Atlas - Static EDA Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #202124;
            background: #fafafa;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 0;
        }

        h1 {
            font-size: 2rem;
            font-weight: 400;
            margin: 0;
            padding: 24px 30px;
            color: #202124;
            background: white;
            border-bottom: 1px solid #e0e0e0;
        }

        h2 {
            font-size: 1.5rem;
            font-weight: 500;
            margin-top: 40px;
            margin-bottom: 16px;
            color: #202124;
            padding-left: 0;
            border-left: none;
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 500;
            margin-top: 24px;
            margin-bottom: 12px;
            color: #3c4043;
        }

        .subtitle {
            font-size: 0.95rem;
            color: #5f6368;
            padding: 16px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 400;
        }

        .section {
            padding: 0 30px 40px 30px;
            margin-bottom: 0;
        }

        .insight-box {
            background: #e8f0fe;
            border-left: 3px solid #1a73e8;
            padding: 16px;
            margin: 20px 0;
            border-radius: 0;
            font-size: 0.95rem;
        }

        .insight-box strong {
            color: #1a73e8;
        }

        .warning-box {
            background: #fef7e0;
            border-left: 3px solid #f9ab00;
            padding: 16px;
            margin: 20px 0;
            border-radius: 0;
            font-size: 0.95rem;
        }

        .code-block {
            background: #f5f5f5;
            color: #37474f;
            padding: 16px;
            border-radius: 4px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Roboto Mono', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.5;
            border: 1px solid #e0e0e0;
        }

        .code-block .comment {
            color: #6a737d;
        }

        .code-block .keyword {
            color: #d73a49;
        }

        .code-block .string {
            color: #032f62;
        }

        .code-block .function {
            color: #6f42c1;
        }

        .viz-container {
            margin: 30px 0;
            text-align: center;
            background: white;
            padding: 0;
            border: none;
            border-radius: 0;
        }

        .viz-container img {
            max-width: 100%;
            height: auto;
            box-shadow: none;
            border: 1px solid #e0e0e0;
        }

        .viz-container iframe {
            width: 100%;
            height: 550px;
            border: 1px solid #e0e0e0;
        }

        .viz-caption {
            margin-top: 12px;
            font-size: 0.9rem;
            color: #5f6368;
            font-style: normal;
        }

        .metadata {
            background: #f8f9fa;
            padding: 16px 30px;
            border-radius: 0;
            margin-bottom: 0;
            font-size: 0.9rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .metadata strong {
            color: #202124;
            font-weight: 500;
        }

        ul {
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }

        li {
            margin-bottom: 8px;
        }

        code {
            background: #f1f3f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.9em;
            color: #37474f;
        }

        .method-section {
            background: #f8f9fa;
            padding: 16px;
            margin: 20px 0;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }

        .stat-highlight {
            font-weight: 600;
            color: #1a73e8;
            background: #e8f0fe;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .footer {
            margin-top: 40px;
            padding: 30px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            color: #5f6368;
            font-size: 0.85rem;
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <h1>PGH TRANSIT ATLAS</h1>
        <div class="subtitle">
            <strong>Exploratory Data Analysis Report</strong><br>
            Static Visualization Submission (Seaborn + Folium)<br>
            By Rizaldy Utomo | Public Policy, Analytics, AI Management @ CMU
        </div>

        <div style="text-align: center; padding: 24px 30px; background: white; border-bottom: 1px solid #e0e0e0;">
            <a href="https://rzrizaldy.github.io/pgh-transit-atlas/"
               style="display: inline-block; background: #1a73e8; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; font-weight: 500; font-size: 0.95rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); transition: background 0.2s;">
                ðŸšŒ ðŸš´ Go to PGH TRANSIT ATLAS (Interactive Viz)
            </a>
        </div>

        <div class="metadata">
            <strong>Dataset:</strong> POGOH Bikeshare (556,437 trips) + PRT Bus (1,200+ stops)<br>
            <strong>Tech Stack:</strong> Python (Pandas, Seaborn, Bokeh), scikit-learn, Haversine<br>
            <strong>Geographic Scope:</strong> Pittsburgh Metro Area (40.35-40.55Â°N, -80.10 to -79.85Â°W)
        </div>

        <!-- SECTION 1: INTRODUCTION -->
        <div class="section">
            <h2>1. Research Question & Motivation</h2>
            <p>
                <strong>Core Question:</strong> How can we optimize micro-mobility integration with public transit in a student-dominated urban environment?
            </p>
            <p style="margin-top: 15px;">
                Pittsburgh's bikeshare system operates in a unique context: 68% of trips occur in the <strong>Campus Corridor</strong> (CMU/Pitt bounding box).
                This creates extreme seasonal volatilityâ€”ridership drops 63% during academic breaks. Traditional transit planning assumes stable demand;
                this analysis reveals the necessity of <em>dynamic fleet scaling</em> tied to the academic calendar.
            </p>

            <div class="insight-box">
                <strong>Key Insight:</strong> Unlike typical bikeshare systems that serve commuters year-round, Pittsburgh's system functions as a
                <strong>"Campus Mobility Extension"</strong> requiring different operational strategies than traditional urban bikeshare.
            </div>
        </div>

        <!-- SECTION 2: DATA SOURCES -->
        <div class="section">
            <h2>2. Data Sources & Processing</h2>

            <div class="method-section">
                <h3>2.1 POGOH Bikeshare Dataset</h3>
                <ul>
                    <li><strong>Source:</strong> Official POGOH trip logs (2024 full year)</li>
                    <li><strong>Volume:</strong> 556,437 trips</li>
                    <li><strong>Schema:</strong> Start/End timestamps, Station names, Duration, Rider type (Member/Casual), Demographics</li>
                    <li><strong>Cleaning:</strong> Removed trips >180 min (outliers/theft), geocoded station coordinates via fuzzy matching</li>
                </ul>

                <div class="code-block">
<span class="comment"># Data Cleaning Pipeline (etl.py lines 85-110)</span>
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime

<span class="comment"># Load raw data</span>
pogoh = pd.<span class="function">read_excel</span>(<span class="string">'dataset/POGOH_2024.xlsx'</span>)

<span class="comment"># Parse timestamps</span>
pogoh[<span class="string">'Start Date'</span>] = pd.<span class="function">to_datetime</span>(pogoh[<span class="string">'Start Date'</span>])
pogoh[<span class="string">'End Date'</span>] = pd.<span class="function">to_datetime</span>(pogoh[<span class="string">'End Date'</span>])

<span class="comment"># Calculate duration in seconds</span>
pogoh[<span class="string">'Duration'</span>] = (pogoh[<span class="string">'End Date'</span>] - pogoh[<span class="string">'Start Date'</span>]).<span class="function">dt</span>.total_seconds()

<span class="comment"># Remove outliers (>180 min = theft/data error)</span>
trips_clean = pogoh[pogoh[<span class="string">'Duration'</span>] <= 10800]  <span class="comment"># 180 min</span>

<span class="comment"># Extract temporal features</span>
trips_clean[<span class="string">'hour'</span>] = trips_clean[<span class="string">'Start Date'</span>].<span class="function">dt</span>.hour
trips_clean[<span class="string">'day_of_week'</span>] = trips_clean[<span class="string">'Start Date'</span>].<span class="function">dt</span>.day_name()
trips_clean[<span class="string">'month'</span>] = trips_clean[<span class="string">'Start Date'</span>].<span class="function">dt</span>.month
                </div>
            </div>

            <div class="method-section">
                <h3>2.2 PRT Bus Stop Dataset</h3>
                <ul>
                    <li><strong>Source:</strong> Port Authority Transit (PRT) official stop registry</li>
                    <li><strong>Volume:</strong> 1,223 bus stops</li>
                    <li><strong>Schema:</strong> Stop name, Coordinates (lat/lon), Annual boardings</li>
                    <li><strong>Integration:</strong> Haversine distance calculation to find POGOH stations within 400m of each bus stop</li>
                </ul>

                <div class="code-block">
<span class="comment"># Haversine Distance Calculation (etl.py lines 320-335)</span>
<span class="keyword">from</span> math <span class="keyword">import</span> radians, sin, cos, sqrt, atan2

<span class="keyword">def</span> <span class="function">haversine</span>(lat1, lon1, lat2, lon2):
    R = 6371000  <span class="comment"># Earth radius in meters</span>

    lat1, lon1, lat2, lon2 = <span class="function">map</span>(radians, [lat1, lon1, lat2, lon2])
    dlat = lat2 - lat1
    dlon = lon2 - lon1

    a = sin(dlat/2)**2 + cos(lat1) * cos(lat2) * sin(dlon/2)**2
    c = 2 * atan2(sqrt(a), sqrt(1-a))

    <span class="keyword">return</span> R * c  <span class="comment"># Returns distance in meters</span>

<span class="comment"># Find bikeshare stations within 400m of each bus stop</span>
<span class="keyword">for</span> idx, bus_stop <span class="keyword">in</span> bus_stops.<span class="function">iterrows</span>():
    nearby_trips = trips_clean[
        trips_clean[<span class="string">'Start Station Name'</span>].<span class="function">apply</span>(
            <span class="keyword">lambda</span> x: <span class="function">haversine</span>(x.lat, x.lon, bus_stop.lat, bus_stop.lon) <= 400
        )
    ]
    bus_stops.<span class="function">loc</span>[idx, <span class="string">'bike_trips_nearby'</span>] = <span class="function">len</span>(nearby_trips)
                </div>
            </div>
        </div>

        <!-- SECTION 3: TEMPORAL ANALYSIS -->
        <div class="section">
            <h2>3. Temporal Dynamics: The "Student Effect"</h2>

            <h3>3.1 Daily Ridership Pattern</h3>
            <p>
                The most striking feature of Pittsburgh's bikeshare is the <strong>academic calendar dependency</strong>.
                Daily ridership fluctuates from 412 trips (winter break nadir) to 3,800+ trips (fall semester peak)â€”a
                <span class="stat-highlight">9Ã— variance</span>.
            </p>

            <div class="viz-container">
                <img src="static_viz/fig1_daily_timeseries.png" alt="Daily Timeseries">
                <div class="viz-caption">
                    Figure 1: 365-day timeseries showing Campus vs City ridership. Campus trips (orange) collapse during academic breaks while City trips (green) remain stable.
                </div>
            </div>

            <div class="insight-box">
                <strong>Policy Implication:</strong> Fleet sizing must be <em>dynamically adjusted</em> based on academic calendar.
                Operating a full fleet during winter break wastes capital on underutilized bikes. Conversely, insufficient capacity
                during September orientation week creates access bottlenecks.
            </div>

            <div class="method-section">
                <h3>Methodology: Campus Geofencing</h3>
                <p>Trips flagged as "Campus Corridor" if start OR end coordinates fall within:</p>
                <ul>
                    <li><strong>Latitude:</strong> 40.435Â°N to 40.450Â°N</li>
                    <li><strong>Longitude:</strong> -79.970Â°W to -79.940Â°W</li>
                </ul>
                <p>This bounding box captures CMU, University of Pittsburgh, and Shadyside neighborhoods.</p>

                <div class="code-block">
<span class="comment"># Campus Flag Logic (etl.py lines 156-165)</span>
CAMPUS_LAT_MIN, CAMPUS_LAT_MAX = 40.435, 40.450
CAMPUS_LON_MIN, CAMPUS_LON_MAX = -79.970, -79.940

trips_clean[<span class="string">'is_campus'</span>] = (
    ((trips_clean[<span class="string">'Start Lat'</span>] >= CAMPUS_LAT_MIN) &
     (trips_clean[<span class="string">'Start Lat'</span>] <= CAMPUS_LAT_MAX) &
     (trips_clean[<span class="string">'Start Lon'</span>] >= CAMPUS_LON_MIN) &
     (trips_clean[<span class="string">'Start Lon'</span>] <= CAMPUS_LON_MAX)) |
    ((trips_clean[<span class="string">'End Lat'</span>] >= CAMPUS_LAT_MIN) &
     (trips_clean[<span class="string">'End Lat'</span>] <= CAMPUS_LAT_MAX) &
     (trips_clean[<span class="string">'End Lon'</span>] >= CAMPUS_LON_MIN) &
     (trips_clean[<span class="string">'End Lon'</span>] <= CAMPUS_LON_MAX))
)

<span class="comment"># Result: 68.1% of all trips touch the Campus Corridor</span>
campus_pct = trips_clean[<span class="string">'is_campus'</span>].<span class="function">sum</span>() / <span class="function">len</span>(trips_clean) * 100
<span class="keyword">print</span>(<span class="string">f"Campus trips: {campus_pct:.1f}%"</span>)  <span class="comment"># Output: 68.1%</span>
                </div>
            </div>

            <h3>3.2 Hourly & Weekly Patterns</h3>
            <p>
                Beyond seasonal shifts, intra-day patterns reveal two distinct peaks: <strong>morning rush (8-9 AM)</strong> and
                <strong>evening rush (4-6 PM)</strong>. Weekend patterns flatten significantly, with Saturday/Sunday showing
                30-40% lower volume than weekdays.
            </p>

            <div class="viz-container">
                <iframe src="static_viz/fig4_hourly_bokeh.html"></iframe>
                <div class="viz-caption">
                    Figure 2: Interactive hourly pattern (Bokeh). Hover over points to see exact trip counts. Clear bimodal distribution at 9 AM and 5 PM.
                </div>
            </div>

            <div class="viz-container">
                <img src="static_viz/fig5_heatmap.png" alt="Day Ã— Hour Heatmap">
                <div class="viz-caption">
                    Figure 3: Day Ã— Hour heatmap (Seaborn). Darker red = higher demand. Notice the "Weekend Cooling" (Sat/Sun columns) and "Morning Surge" (7-9 AM rows).
                </div>
            </div>

            <div class="insight-box">
                <strong>Rebalancing Strategy:</strong> The heatmap reveals exact windows for fleet repositioning.
                Optimal rebalancing occurs during <span class="stat-highlight">10-11 AM</span> (post-morning rush, pre-lunch)
                and <span class="stat-highlight">7-8 PM</span> (post-evening rush). These low-demand windows minimize user disruption.
            </div>
        </div>

        <!-- SECTION 4: BEHAVIORAL SEGMENTATION -->
        <div class="section">
            <h2>4. Unsupervised Learning: Trip Archetypes</h2>

            <h3>4.1 K-Means Clustering Methodology</h3>
            <p>
                To understand <em>why</em> people ride, we apply K-Means clustering on three features:
                <strong>Duration</strong>, <strong>Displacement</strong>, and <strong>Start Hour</strong>.
                This unsupervised approach identifies behavioral patterns without labeled training data.
            </p>

            <div class="method-section">
                <h3>Algorithm Rationale</h3>
                <ul>
                    <li><strong>K-Means (k=4):</strong> Chosen for interpretability. Silhouette analysis validated 4 as optimal cluster count (score: 0.68).</li>
                    <li><strong>Feature Scaling:</strong> StandardScaler ensures duration (seconds), displacement (meters), and hour (0-23) contribute equally.</li>
                    <li><strong>Feature Selection:</strong> Duration + Displacement capture trip purpose better than speed alone. Hour captures temporal behavior (commute vs leisure).</li>
                </ul>

                <div class="code-block">
<span class="comment"># K-Means Implementation (etl.py lines 196-223)</span>
<span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans
<span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler

<span class="comment"># Prepare features</span>
features = trips_clean[[<span class="string">'Duration'</span>, <span class="string">'displacement'</span>, <span class="string">'hour'</span>]].<span class="function">dropna</span>()

<span class="comment"># Standardize features (mean=0, std=1)</span>
scaler = <span class="function">StandardScaler</span>()
features_scaled = scaler.<span class="function">fit_transform</span>(features)

<span class="comment"># Fit K-Means (k=4 determined via elbow method)</span>
kmeans = <span class="function">KMeans</span>(n_clusters=4, random_state=42, n_init=10)
trips_clean[<span class="string">'archetype'</span>] = kmeans.<span class="function">fit_predict</span>(features_scaled)

<span class="comment"># Calculate cluster centroids</span>
centroids = trips_clean.<span class="function">groupby</span>(<span class="string">'archetype'</span>).<span class="function">agg</span>({
    <span class="string">'Duration'</span>: <span class="string">'mean'</span>,
    <span class="string">'displacement'</span>: <span class="string">'mean'</span>,
    <span class="string">'hour'</span>: <span class="string">'mean'</span>
})

<span class="comment"># Manual labeling based on centroid inspection:</span>
<span class="comment"># Cluster 0: Short duration (7.7 min), peak at 5:47 PM â†’ "Commuter"</span>
<span class="comment"># Cluster 1: Medium duration (20.1 min), mid-day â†’ "Errand"</span>
<span class="comment"># Cluster 2: Very short (7.0 min), morning peak â†’ "Last-Mile"</span>
<span class="comment"># Cluster 3: LONG duration (73.2 min!), low displacement â†’ "Leisure"</span>
                </div>
            </div>

            <h3>4.2 Identified Archetypes</h3>

            <div class="viz-container">
                <img src="static_viz/fig2_archetypes.png" alt="Trip Archetypes">
                <div class="viz-caption">
                    Figure 4: Trip distribution by behavioral archetype (Seaborn). Commuter trips dominate at 47.9%, followed by Last-Mile connectors at 32.8%.
                </div>
            </div>

            <div class="insight-box">
                <strong>Unexpected Finding:</strong> <span class="stat-highlight">Leisure trips (3.6%)</span> have an average duration of
                <span class="stat-highlight">73.2 minutes</span> with displacement of only 737m. This suggests recreational "circular routes"
                along the riverfront trail systemâ€”users exploring rather than commuting. These trips require different bike availability
                (longer rental periods, trail-adjacent stations).
            </div>

            <div class="warning-box">
                <strong>Interpretation Note:</strong> "Last-Mile" trips (32.8%) peak at 9:18 AM with 7-minute duration.
                These are <em>not</em> standalone tripsâ€”they're bikeshare-to-bus connections. Cross-referencing with PRT data
                confirms high overlap with major bus hubs (Boulevard of the Allies, S Millvale Ave).
            </div>
        </div>

        <!-- SECTION 5: STATION BEHAVIORAL PROFILING -->
        <div class="section">
            <h2>5. Station Behavioral Profiling</h2>

            <h3>5.1 Reverse Analysis: Station "Personalities"</h3>
            <p>
                After identifying <em>trip</em> archetypes, we reverse the question: <strong>Which stations generate which behaviors?</strong>
                This reveals "station personalities"â€”some stations are pure commuter hubs (64.8% commuter trips), while others
                are errand centers (68.4% errand trips). This profiling is critical for:
            </p>
            <ul>
                <li><strong>Targeted Rebalancing:</strong> Commuter hubs need bikes at 8 AM; errand centers need them at 2 PM</li>
                <li><strong>Bike Type Assignment:</strong> Leisure stations should stock e-bikes for longer trips; commuter hubs need standard bikes</li>
                <li><strong>Capacity Planning:</strong> High-percentage stations signal demand concentration</li>
            </ul>

            <div class="method-section">
                <h3>Methodology</h3>
                <ol>
                    <li>For each station, calculate percentage of trips matching each archetype (Commuter/Last-Mile/Errand/Leisure)</li>
                    <li>Filter for statistical significance: only stations with <strong>50+ total trips</strong></li>
                    <li>Select <strong>top 3 stations</strong> with highest percentage for each archetype</li>
                </ol>

                <div class="code-block">
<span class="comment"># Station Profiling (etl.py lines 580-617)</span>
station_archetype_top = {}

<span class="keyword">for</span> archetype <span class="keyword">in</span> [<span class="string">'Commuter'</span>, <span class="string">'Last-Mile'</span>, <span class="string">'Errand'</span>, <span class="string">'Leisure'</span>]:
    <span class="comment"># Count trips by station for this archetype</span>
    station_counts = trips_clean.<span class="function">groupby</span>([<span class="string">'Start Station Name'</span>, <span class="string">'archetype_label'</span>]).<span class="function">size</span>()

    <span class="comment"># Get total trips per station</span>
    station_totals = trips_clean.<span class="function">groupby</span>(<span class="string">'Start Station Name'</span>).<span class="function">size</span>()

    <span class="comment"># Calculate percentage</span>
    station_pct = (station_counts / station_totals) * 100

    <span class="comment"># Filter: only stations with 50+ trips</span>
    significant_stations = station_pct[station_totals >= 50]

    <span class="comment"># Get top 3 by percentage</span>
    top_3 = significant_stations.<span class="function">nlargest</span>(3)

    station_archetype_top[archetype] = {
        <span class="string">'stations'</span>: top_3.<span class="function">index</span>.<span class="function">tolist</span>(),
        <span class="string">'percentages'</span>: top_3.<span class="function">values</span>.<span class="function">tolist</span>()
    }
                </div>
            </div>

            <h3>5.2 Behavioral Hotspots</h3>

            <div class="viz-container">
                <img src="static_viz/fig6_station_archetypes.png" alt="Station Archetypes">
                <div class="viz-caption">
                    Figure 5: Top 3 stations per archetype (Seaborn 2Ã—2 grid). Each quadrant shows stations with highest concentration of that behavior type.
                </div>
            </div>

            <div class="insight-box">
                <strong>Key Findings:</strong>
                <ul style="margin-top: 10px;">
                    <li><strong>Schenley Dr & Schenley Dr Ext:</strong> 64.8% Commuter trips (12,721 of 19,637) â€” Located at CMU campus edge, pure commuter function</li>
                    <li><strong>Wilkinsburg Park & Ride:</strong> 68.4% Errand trips (444 of 649) â€” Suburban station used primarily for shopping/service trips</li>
                    <li><strong>Boulevard of the Allies:</strong> 46.9% Last-Mile trips (13,859 of 29,538) â€” Critical transit feeder with highest volume</li>
                    <li><strong>South Side Trail:</strong> 19.0% Leisure trips (712 of 3,739) â€” Recreational waterfront destination</li>
                </ul>
            </div>

            <div class="warning-box">
                <strong>Operational Insight:</strong> Schenley Dr (64.8% commuter) vs South Side Trail (19.0% leisure) require
                <em>completely different operational strategies</em>. Schenley needs predictable 8 AM bike availability for class commutes;
                South Side needs afternoon/weekend capacity for exploratory rides. One-size-fits-all rebalancing fails both station types.
            </div>
        </div>

        <!-- SECTION 6: RIDER DEMOGRAPHICS -->
        <div class="section">
            <h2>6. Rider Demographics: Member vs Casual</h2>

            <p>
                POGOH operates a membership model (annual/monthly passes) alongside casual rentals.
                The distribution is heavily skewed: <span class="stat-highlight">98.7% Member, 1.3% Casual</span>.
                This indicates bikeshare functions as a <strong>utilitarian commute tool</strong>, not tourism/recreation.
            </p>

            <div class="viz-container">
                <img src="static_viz/fig3_demographics.png" alt="Rider Type Distribution">
                <div class="viz-caption">
                    Figure 6: Member vs Casual ridership (Seaborn). Members account for 549,304 trips vs 7,133 casual trips.
                </div>
            </div>

            <div class="insight-box">
                <strong>Implication:</strong> Revenue model should prioritize <strong>membership retention</strong> over casual conversion.
                The 98.7% member share suggests Pittsburgh bikeshare succeeds as a <em>daily commute replacement</em>, not a tourist amenity.
                Marketing should focus on student/staff annual memberships tied to CMU/Pitt ID integration.
            </div>

            <div class="viz-container">
                <img src="static_viz/fig8_top_stations.png" alt="Top Stations by Rider Type">
                <div class="viz-caption">
                    Figure 7: Top 10 stations showing Member (blue) vs Casual (orange) split (Seaborn grouped bars).
                    Notice S Bouquet Ave has highest casual shareâ€”likely due to proximity to visitor destinations.
                </div>
            </div>
        </div>

        <!-- SECTION 7: INTERACTIVE EXPLORATION -->
        <div class="section">
            <h2>7. Interactive Archetype Explorer</h2>

            <div class="viz-container">
                <iframe src="static_viz/fig7_archetypes_bokeh.html"></iframe>
                <div class="viz-caption">
                    Figure 8: Interactive archetype bar chart (Bokeh). Hover to see exact trip counts and percentages.
                </div>
            </div>
        </div>

        <!-- SECTION 8: SYNTHESIS -->
        <div class="section">
            <h2>8. Synthesis & Policy Recommendations</h2>

            <h3>8.1 Core Findings</h3>
            <ol>
                <li>
                    <strong>Academic Calendar Dependency:</strong> 68% of trips occur in Campus Corridor, with 63% ridership drop during winter break.
                    <em>Action:</em> Implement dynamic fleet sizing tied to CMU/Pitt academic calendars.
                </li>
                <li>
                    <strong>Behavioral Segmentation:</strong> 4 distinct rider archetypes identified via K-Means. Commuters (47.9%) need reliability;
                    Leisure riders (3.6%) need flexibility. <em>Action:</em> Differentiated service levels per archetype.
                </li>
                <li>
                    <strong>Station Specialization:</strong> Schenley Dr is 64.8% commuter; Wilkinsburg P&R is 68.4% errand.
                    <em>Action:</em> Station-specific rebalancing schedules based on dominant archetype.
                </li>
                <li>
                    <strong>Member Dominance:</strong> 98.7% member trips indicate success as utilitarian tool, not tourist amenity.
                    <em>Action:</em> Double down on institutional partnerships (CMU ID integration, corporate memberships).
                </li>
            </ol>
        </div>

        <!-- SECTION 9: DATA AVAILABILITY -->
        <div class="section">
            <h2>9. Processed Data Exports</h2>

            <p>All processed datasets available in <code>/processed_data/</code> directory for reproducibility:</p>

            <div class="method-section">
                <strong>CSV Files (14 total):</strong>
                <ul style="column-count: 2; column-gap: 30px; margin-top: 10px;">
                    <li>daily_timeseries.csv</li>
                    <li>archetypes.csv</li>
                    <li>demographics.csv</li>
                    <li>station_archetypes.csv</li>
                    <li>heatmap.csv</li>
                    <li>monthly_trends.csv</li>
                    <li>duration_distribution.csv</li>
                    <li>directionality.csv</li>
                    <li>correlation.csv</li>
                    <li>top_prt_pogoh.csv</li>
                    <li>bike_stations_geo.csv</li>
                    <li>bus_stops_geo.csv</li>
                    <li>seasonal_heatmap.csv</li>
                    <li>multimodal_hubs.csv</li>
                </ul>

                <strong>JSON Files (13 total):</strong> Identical data in JSON format for web dashboard integration.
            </div>

            <div class="insight-box">
                <strong>Reproducibility:</strong> This analysis can be fully reproduced by running <code>python3 etl.py</code>
                followed by <code>python3 generate_static_viz.py</code>. All data sources, cleaning steps, and statistical methods
                are documented in-line with code comments matching this report's narrative.
            </div>
        </div>

        <!-- SECTION 10: THOUGHT PROCESS -->
        <div class="section">
            <h2>10. EDA Thought Process: From Raw Data to Insight</h2>

            <h3>Step 1: Initial Data Exploration</h3>
            <div class="code-block">
<span class="comment"># First look at the data structure</span>
pogoh = pd.<span class="function">read_excel</span>(<span class="string">'dataset/POGOH_2024.xlsx'</span>)
<span class="keyword">print</span>(pogoh.<span class="function">shape</span>)  <span class="comment"># (556437, 12)</span>
<span class="keyword">print</span>(pogoh.<span class="function">info</span>())
<span class="keyword">print</span>(pogoh.<span class="function">describe</span>())

<span class="comment"># Thought: 556K trips is substantial. What's the temporal coverage?</span>
<span class="keyword">print</span>(pogoh[<span class="string">'Start Date'</span>].<span class="function">min</span>(), pogoh[<span class="string">'Start Date'</span>].<span class="function">max</span>())
<span class="comment"># Output: 2024-01-01 to 2024-12-31 â†’ Full year âœ“</span>
            </div>

            <h3>Step 2: Identifying Anomalies</h3>
            <div class="code-block">
<span class="comment"># Check for outliers in duration</span>
<span class="keyword">print</span>(pogoh[<span class="string">'Duration'</span>].<span class="function">describe</span>())
<span class="comment"># Max: 86,400 seconds (24 hours!) â†’ Likely theft or forgotten bike</span>

<span class="comment"># Distribution check</span>
<span class="keyword">print</span>(pogoh[pogoh[<span class="string">'Duration'</span>] > 10800].<span class="function">shape</span>)  <span class="comment"># 1,234 trips >3 hours</span>

<span class="comment"># Decision: Remove trips >180 min as outliers (99.8th percentile)</span>
trips_clean = pogoh[pogoh[<span class="string">'Duration'</span>] <= 10800]
            </div>

            <h3>Step 3: Feature Engineering</h3>
            <div class="code-block">
<span class="comment"># Question: Do students vs residents have different trip patterns?</span>
<span class="comment"># Hypothesis: Campus trips should be shorter, peak-hour focused</span>

<span class="comment"># Create campus flag via geographic bounding box</span>
trips_clean[<span class="string">'is_campus'</span>] = (
    (trips_clean[<span class="string">'Start Lat'</span>].<span class="function">between</span>(40.435, 40.450)) &
    (trips_clean[<span class="string">'Start Lon'</span>].<span class="function">between</span>(-79.970, -79.940))
)

<span class="comment"># Validate hypothesis</span>
<span class="keyword">print</span>(trips_clean.<span class="function">groupby</span>(<span class="string">'is_campus'</span>)[<span class="string">'Duration'</span>].<span class="function">mean</span>())
<span class="comment"># Campus: 9.2 min avg | City: 12.7 min avg â†’ Hypothesis CONFIRMED âœ“</span>
            </div>

            <h3>Step 4: Clustering for Behavior Discovery</h3>
            <p>
                Instead of assuming trip purposes (commute/leisure), let unsupervised learning <em>discover</em> natural groupings.
                K-Means revealed 4 clusters, including a surprising "Leisure" segment with 73-minute average durationâ€”this wasn't
                anticipated in the initial hypothesis.
            </p>

            <div class="code-block">
<span class="comment"># Question: What natural behavioral segments exist?</span>
<span class="comment"># Approach: K-Means on Duration, Displacement, Hour</span>

<span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans

features = trips_clean[[<span class="string">'Duration'</span>, <span class="string">'displacement'</span>, <span class="string">'hour'</span>]]
kmeans = <span class="function">KMeans</span>(n_clusters=4, random_state=42)
trips_clean[<span class="string">'cluster'</span>] = kmeans.<span class="function">fit_predict</span>(features)

<span class="comment"># Inspect centroids to assign semantic labels</span>
centroids = kmeans.cluster_centers_
<span class="keyword">print</span>(centroids)

<span class="comment"># Cluster 3: Duration=4392s (73 min!), Displacement=737m, Hour=14.4</span>
<span class="comment"># â†’ Long rides, low displacement, afternoon â†’ "Leisure" âœ“</span>
            </div>

            <h3>Step 5: Validation & Iteration</h3>
            <div class="insight-box">
                <strong>Iterative Refinement:</strong> Initial clustering used only Duration + Displacement.
                This conflated "Commuter" and "Last-Mile" (both short, efficient trips). Adding <strong>Start Hour</strong>
                as a third feature separated them: Commuters peak at 5 PM, Last-Mile peaks at 9 AM.
                This demonstrates importance of <em>domain knowledge in feature engineering</em>.
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <p><strong>Pittsburgh Transit Atlas - Static EDA Report</strong></p>
            <p>Generated using Python (Seaborn + Bokeh) | November 2025</p>
            <p>Interactive Dashboard: <a href="index.html" style="color: #2B4CFF; font-weight: bold;">index.html</a></p>
            <p style="margin-top: 10px;">
                Data Sources: POGOH Bikeshare (2024), Port Authority Transit (PRT)<br>
                All processed data available in <code>/processed_data/</code> directory
            </p>
        </div>
    </div>
</body>
</html>
